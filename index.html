<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Riset Sosial Humaniora - Monitoring Penelitian</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Custom CSS -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap');
        
        * {
            font-family: 'Inter', 'Poppins', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            min-height: 100vh;
        }
        
        .card {
            background: white;
            border-radius: 16px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.05);
            border: 1px solid #e2e8f0;
            transition: all 0.3s ease;
        }
        
        .card:hover {
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.08);
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(37, 99, 235, 0.2);
        }
        
        .btn-secondary {
            background: #f1f5f9;
            color: #475569;
            font-weight: 500;
            border: 1px solid #cbd5e1;
            transition: all 0.3s ease;
        }
        
        .btn-secondary:hover {
            background: #e2e8f0;
            transform: translateY(-1px);
        }
        
        .progress-bar {
            height: 10px;
            border-radius: 10px;
            overflow: hidden;
            background: #e2e8f0;
        }
        
        .progress-fill {
            height: 100%;
            border-radius: 10px;
            transition: width 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
            background: linear-gradient(90deg, #10b981 0%, #3b82f6 100%);
        }
        
        .stat-card {
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-4px);
        }
        
        .table-header {
            background: #f8fafc;
            border-bottom: 2px solid #e2e8f0;
        }
        
        .table-row {
            border-bottom: 1px solid #f1f5f9;
            transition: all 0.2s ease;
        }
        
        .table-row:hover {
            background: #f8fafc;
        }
        
        .floating-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 1000;
            transition: all 0.3s ease;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 8px 25px rgba(37, 99, 235, 0.3);
        }
        
        .floating-btn:hover {
            transform: scale(1.1) rotate(90deg);
            box-shadow: 0 12px 30px rgba(37, 99, 235, 0.4);
        }
        
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1001;
            display: none;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(4px);
        }
        
        .modal-content {
            background: white;
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            max-height: 85vh;
            overflow-y: auto;
            padding: 30px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
            animation: modalAppear 0.3s ease-out;
        }
        
        @keyframes modalAppear {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        input, select, textarea {
            border: 1px solid #cbd5e1;
            border-radius: 10px;
            padding: 12px 16px;
            font-size: 15px;
            transition: all 0.3s ease;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .badge {
            display: inline-flex;
            align-items: center;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .scrollbar-thin {
            scrollbar-width: thin;
            scrollbar-color: #cbd5e1 #f1f5f9;
        }
        
        .scrollbar-thin::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        
        .scrollbar-thin::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 10px;
        }
        
        .scrollbar-thin::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 10px;
        }
        
        .scrollbar-thin::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
        
        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(59, 130, 246, 0); }
            100% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0); }
        }
        
        /* Judul penelitian styling */
        .judul-penelitian {
            line-height: 1.5;
            word-break: break-word;
            hyphens: auto;
            padding: 8px 0;
        }
        
        /* Status colors */
        .status-success { color: #10b981; }
        .status-warning { color: #f59e0b; }
        .status-danger { color: #ef4444; }
        .status-info { color: #3b82f6; }
        
        /* Filter buttons */
        .filter-btn {
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .filter-btn.active {
            background: #3b82f6;
            color: white;
        }
        
        .filter-btn.inactive {
            background: #f1f5f9;
            color: #64748b;
            border: 1px solid #e2e8f0;
        }
        
        .filter-btn.inactive:hover {
            background: #e2e8f0;
        }
        
        /* Notifikasi Pesan */
        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
            font-size: 11px;
            font-weight: 600;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: pulse 2s infinite;
            box-shadow: 0 3px 10px rgba(245, 158, 11, 0.3);
        }
        
        .notification-shine {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 50%, #d97706 100%);
            box-shadow: 0 0 20px rgba(245, 158, 11, 0.7);
        }
        
        .notification-modal {
            max-width: 600px;
        }
        
        .message-item {
            border-left: 4px solid #3b82f6;
            padding-left: 15px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }
        
        .message-item:hover {
            background: #f8fafc;
            transform: translateX(5px);
        }
        
        .message-unread {
            border-left-color: #f59e0b;
            background: linear-gradient(to right, rgba(245, 158, 11, 0.05), transparent);
        }
        
        @keyframes shine {
            0% { box-shadow: 0 0 10px rgba(245, 158, 11, 0.5); }
            50% { box-shadow: 0 0 20px rgba(245, 158, 11, 0.8); }
            100% { box-shadow: 0 0 10px rgba(245, 158, 11, 0.5); }
        }
        
        .notification-button {
            animation: shine 2s infinite;
            position: relative;
            overflow: hidden;
        }
        
        .notification-button::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transform: rotate(45deg);
            animation: slide 3s infinite linear;
        }
        
        @keyframes slide {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }
    </style>
</head>
<body class="text-gray-800 min-h-screen">
    <!-- Login Container -->
    <div id="loginContainer" class="max-w-md mx-auto mt-8 md:mt-16 px-4 fade-in">
        <div class="card p-8 md:p-10">
            <div class="text-center mb-8">
                <div class="inline-flex items-center justify-center w-20 h-20 rounded-full bg-gradient-to-r from-blue-50 to-indigo-50 mb-5">
                    <i class="fas fa-book-open text-3xl text-blue-600"></i>
                </div>
                <h1 class="text-3xl font-bold text-gray-900 mb-2">Riset Sosial Humaniora</h1>
                <p class="text-gray-600">Monitoring Progress Penelitian Siswa</p>
            </div>
            
            <div class="space-y-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Nama Depan Ketua</label>
                    <div class="relative">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <i class="fas fa-user text-gray-400"></i>
                        </div>
                        <input type="text" id="user" placeholder="cth: Ahmad" 
                               class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition">
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Nama Depan Anggota</label>
                    <div class="relative">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <i class="fas fa-users text-gray-400"></i>
                        </div>
                        <input type="text" id="pass" placeholder="cth: Budi" 
                               class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition">
                    </div>
                    <p class="text-xs text-gray-500 mt-2"><i class="fas fa-info-circle mr-1"></i> Gunakan nama depan anggota sebagai password</p>
                </div>
                
                <button onclick="login()" 
                        class="w-full py-3.5 btn-primary rounded-xl font-semibold text-lg shadow-lg">
                    <i class="fas fa-sign-in-alt mr-2"></i> Masuk ke Dashboard
                </button>
                
                <div id="info" class="text-center text-sm min-h-6 mt-4"></div>
                
                <div class="pt-6 border-t border-gray-100 text-center">
                    <p class="text-sm text-gray-500">
                        <i class="fas fa-shield-alt mr-1"></i> Data aman dan hanya dapat diakses oleh kelompok masing-masing
                    </p>
                </div>
            </div>
        </div>
        
        <div class="text-center mt-8 text-gray-500 text-sm">
            <p>¬© 2023 Sistem Monitoring Riset Sosial Humaniora</p>
        </div>
    </div>
    
    <!-- Dashboard Container (Hidden by default) -->
    <div id="dashboardContainer" class="max-w-7xl mx-auto px-4 py-6 hidden fade-in">
        <!-- Header dengan Notifikasi -->
        <div class="flex flex-col md:flex-row md:items-center justify-between mb-6">
            <div>
                <h1 class="text-2xl md:text-3xl font-bold text-gray-900">üìä Dashboard Monitoring Riset</h1>
                <p class="text-gray-600 mt-2">Pantau progress penelitian Anda di sini</p>
            </div>
            <div class="flex items-center space-x-3 mt-4 md:mt-0">
                <!-- Tombol Notifikasi Pesan -->
                <button id="notificationButton" onclick="openMessageModal()" 
                        class="px-4 py-2.5 bg-gradient-to-r from-amber-500 to-orange-500 hover:from-amber-600 hover:to-orange-600 text-white rounded-lg font-medium transition shadow-lg relative notification-button hidden">
                    <i class="fas fa-envelope mr-2"></i> Pesan Masuk
                    <div id="notificationBadge" class="notification-badge hidden"></div>
                </button>
                
                <button onclick="refreshProgressData()" class="px-4 py-2.5 btn-secondary rounded-lg font-medium">
                    <i class="fas fa-sync-alt mr-2"></i> Refresh
                </button>
                <button onclick="logout()" class="px-4 py-2.5 bg-gradient-to-r from-rose-500 to-pink-500 hover:from-rose-600 hover:to-pink-600 text-white rounded-lg font-medium transition shadow-md hover:shadow-lg">
                    <i class="fas fa-sign-out-alt mr-2"></i> Keluar
                </button>
            </div>
        </div>
        
        <!-- Info Kelompok -->
        <div class="card p-6 mb-8">
            <div class="flex items-center mb-6">
                <div class="w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center mr-3">
                    <i class="fas fa-users text-blue-600"></i>
                </div>
                <h2 class="text-xl font-bold text-gray-900">Informasi Kelompok</h2>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-5">
                <div class="stat-card bg-gradient-to-br from-blue-50 to-indigo-50 border border-blue-100">
                    <div class="flex items-center mb-3">
                        <div class="w-12 h-12 rounded-full bg-white flex items-center justify-center mr-3 shadow-sm">
                            <i class="fas fa-user-tie text-blue-600"></i>
                        </div>
                        <div>
                            <p class="text-sm text-gray-600">Ketua Kelompok</p>
                            <p id="ketua" class="font-bold text-gray-900 text-lg">-</p>
                        </div>
                    </div>
                </div>
                
                <div class="stat-card bg-gradient-to-br from-emerald-50 to-green-50 border border-emerald-100">
                    <div class="flex items-center mb-3">
                        <div class="w-12 h-12 rounded-full bg-white flex items-center justify-center mr-3 shadow-sm">
                            <i class="fas fa-users text-emerald-600"></i>
                        </div>
                        <div>
                            <p class="text-sm text-gray-600">Anggota Kelompok</p>
                            <p id="anggota" class="font-bold text-gray-900 text-lg">-</p>
                        </div>
                    </div>
                </div>
                
                <div class="stat-card bg-gradient-to-br from-violet-50 to-purple-50 border border-violet-100">
                    <div class="flex items-center mb-3">
                        <div class="w-12 h-12 rounded-full bg-white flex items-center justify-center mr-3 shadow-sm">
                            <i class="fas fa-tags text-violet-600"></i>
                        </div>
                        <div>
                            <p class="text-sm text-gray-600">Kategori Penelitian</p>
                            <p id="kategori" class="font-bold text-gray-900 text-lg">-</p>
                        </div>
                    </div>
                </div>
                
                <div class="stat-card bg-gradient-to-br from-amber-50 to-yellow-50 border border-amber-100">
                    <div class="flex items-center mb-3">
                        <div class="w-12 h-12 rounded-full bg-white flex items-center justify-center mr-3 shadow-sm">
                            <i class="fas fa-book-open text-amber-600"></i>
                        </div>
                        <div>
                            <p class="text-sm text-gray-600">Judul Penelitian</p>
                            <p id="judul" class="font-bold text-gray-900 text-lg judul-penelitian">-</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Progress Monitoring -->
        <div class="card p-6 mb-8">
            <div class="flex flex-col md:flex-row md:items-center justify-between mb-8">
                <div class="flex items-center mb-4 md:mb-0">
                    <div class="w-10 h-10 rounded-full bg-gradient-to-r from-emerald-100 to-green-100 flex items-center justify-center mr-3">
                        <i class="fas fa-chart-line text-emerald-600"></i>
                    </div>
                    <div>
                        <h2 class="text-xl font-bold text-gray-900">üìà Progress Monitoring</h2>
                        <p class="text-gray-600 text-sm">Riwayat perkembangan penelitian Anda</p>
                    </div>
                </div>
                
                <div class="flex items-center space-x-2 mt-4 md:mt-0">
                    <div class="text-sm text-gray-600 mr-2">Filter:</div>
                    <button id="filterAll" class="filter-btn active" onclick="filterProgress('all')">Semua</button>
                    <button id="filterMonth" class="filter-btn inactive" onclick="filterProgress('month')">30 Hari</button>
                    <button id="filterWeek" class="filter-btn inactive" onclick="filterProgress('week')">7 Hari</button>
                </div>
            </div>
            
            <!-- Progress Summary -->
            <div class="mb-10 p-5 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-2xl border border-blue-100">
                <div class="flex flex-col md:flex-row md:items-center justify-between mb-4">
                    <div>
                        <h3 class="font-bold text-gray-900 text-lg">Progress Keseluruhan</h3>
                        <p class="text-gray-600 text-sm">Berdasarkan bagian yang sudah dikerjakan</p>
                    </div>
                    <div class="mt-3 md:mt-0">
                        <span id="progressPercent" class="text-3xl font-bold text-gray-900">0%</span>
                        <span id="progressText" class="text-gray-600 ml-2">(0/8 bagian)</span>
                    </div>
                </div>
                
                <div class="progress-bar">
                    <div id="progressFill" class="progress-fill" style="width: 0%"></div>
                </div>
                
                <div class="flex justify-between mt-3">
                    <span class="text-xs text-gray-500">Belum dimulai</span>
                    <span class="text-xs text-gray-500">Sedang berjalan</span>
                    <span class="text-xs text-gray-500">Selesai</span>
                </div>
                
                <!-- Bagian yang sudah dikerjakan -->
                <div id="completedSections" class="mt-6">
                    <p class="text-sm font-medium text-gray-700 mb-3">Bagian yang sudah dikerjakan:</p>
                    <div id="sectionsList" class="flex flex-wrap gap-2">
                        <span class="text-sm text-gray-500 italic">Belum ada data</span>
                    </div>
                </div>
            </div>
            
            <!-- Progress Table -->
            <div class="mb-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="font-bold text-gray-900">üìã Riwayat Progress</h3>
                    <div class="flex items-center">
                        <i class="fas fa-history text-blue-500 mr-2 text-sm"></i>
                        <span id="lastUpdate" class="text-sm text-gray-600">Data terakhir: -</span>
                    </div>
                </div>
                
                <div class="overflow-x-auto scrollbar-thin rounded-xl border border-gray-200">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="table-header">
                            <tr>
                                <th class="px-6 py-4 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">Tanggal</th>
                                <th class="px-6 py-4 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">Bagian Dikerjakan</th>
                                <th class="px6 py-4 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">Ketercapaian</th>
                                <th class="px-6 py-4 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">Kendala</th>
                                <th class="px-6 py-4 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">Solusi</th>
                            </tr>
                        </thead>
                        <tbody id="progressTable" class="divide-y divide-gray-100">
                            <tr>
                                <td colspan="5" class="px-6 py-10 text-center">
                                    <div class="flex flex-col items-center justify-center">
                                        <i class="fas fa-spinner fa-spin text-3xl text-blue-500 mb-3"></i>
                                        <p class="text-gray-600">Memuat data progress...</p>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Empty State -->
            <div id="emptyProgress" class="hidden text-center py-12">
                <div class="inline-flex items-center justify-center w-20 h-20 rounded-full bg-gray-100 mb-5">
                    <i class="fas fa-clipboard-list text-3xl text-gray-400"></i>
                </div>
                <h3 class="text-lg font-semibold text-gray-900 mb-2">Belum Ada Data Progress</h3>
                <p class="text-gray-600 max-w-md mx-auto mb-6">Tim Anda belum melaporkan progress penelitian. Klik tombol "+" di kanan bawah untuk menambahkan laporan pertama.</p>
                <button onclick="openModal()" class="px-5 py-2.5 btn-primary rounded-lg">
                    <i class="fas fa-plus mr-2"></i> Tambah Progress
                </button>
            </div>
        </div>
        
        <!-- Footer -->
        <div class="text-center text-sm text-gray-500 mt-12 pt-8 border-t border-gray-200">
            <p>Sistem Monitoring Riset Sosial Humaniora &copy; 2023</p>
            <p class="mt-1">Data diambil dari: <a href="https://docs.google.com/spreadsheets/d/108-o2wcOAHNrm1BlBl8YTj1H2YhQxs3WLLcEhJYb1hY/edit?gid=0#gid=0" 
               target="_blank" class="text-blue-600 hover:text-blue-800 font-medium">Spreadsheet Progress Riset</a></p>
        </div>
    </div>
    
    <!-- Floating Button untuk Input Data -->
    <button id="floatingBtn" class="floating-btn hidden bg-gradient-to-r from-blue-600 to-indigo-600 text-white pulse">
        <i class="fas fa-plus text-xl"></i>
    </button>
    
    <!-- Modal Input Data -->
    <div id="modalOverlay" class="modal-overlay">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-6 pb-4 border-b border-gray-200">
                <div>
                    <h2 class="text-xl font-bold text-gray-900">‚ûï Tambah Progress Baru</h2>
                    <p class="text-gray-600 text-sm mt-1">Isi laporan perkembangan penelitian Anda</p>
                </div>
                <button onclick="closeModal()" class="w-10 h-10 rounded-full bg-gray-100 hover:bg-gray-200 flex items-center justify-center transition">
                    <i class="fas fa-times text-gray-600"></i>
                </button>
            </div>
            
            <form id="formRiset" class="space-y-5">
                <!-- Data yang sudah fix dari login -->
                <div class="p-4 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl border border-blue-100">
                    <h3 class="font-semibold text-blue-800 mb-3 flex items-center">
                        <i class="fas fa-info-circle mr-2"></i> Data Kelompok (Otomatis)
                    </h3>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <p class="text-xs text-blue-600 font-medium">Ketua</p>
                            <p id="modalKetua" class="font-semibold text-gray-900">-</p>
                        </div>
                        <div>
                            <p class="text-xs text-blue-600 font-medium">Anggota</p>
                            <p id="modalAnggota" class="font-semibold text-gray-900">-</p>
                        </div>
                        <div>
                            <p class="text-xs text-blue-600 font-medium">Kategori</p>
                            <p id="modalKategori" class="font-semibold text-gray-900">-</p>
                        </div>
                        <div>
                            <p class="text-xs text-blue-600 font-medium">Judul</p>
                            <p id="modalJudul" class="font-semibold text-gray-900 judul-penelitian">-</p>
                        </div>
                    </div>
                </div>
                
                <!-- Input Tanggal -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        <i class="fas fa-calendar-alt mr-1 text-blue-600"></i> Tanggal Progress *
                    </label>
                    <div class="p-3 bg-blue-50 rounded-lg border border-blue-100">
                        <p id="currentDateDisplay" class="font-semibold text-gray-900 text-center">-</p>
                        <input type="hidden" id="timestamp" value="">
                    </div>
                    <p class="text-xs text-gray-500 mt-2">Tanggal otomatis sesuai waktu input data</p>
                </div>
                
                <!-- Input Bagian Dikerjakan -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        <i class="fas fa-tasks mr-1 text-blue-600"></i> Bagian yang Dikerjakan *
                    </label>
                    <select id="bagian" class="w-full" required>
                        <option value="">-- Pilih bagian yang sudah dikerjakan --</option>
                        <option value="Judul Penelitian">üéØ Judul Penelitian</option>
                        <option value="BAB 1 Pendahuluan">üìñ BAB 1 Pendahuluan</option>
                        <option value="BAB 2 Tinjauan Pustaka">üìö BAB 2 Tinjauan Pustaka</option>
                        <option value="BAB 3 Metode Penelitian">üî¨ BAB 3 Metode Penelitian</option>
                        <option value="BAB 4 Hasil dan Pembahasan">üìä BAB 4 Hasil dan Pembahasan</option>
                        <option value="BAB 5 Kesimpulan">‚úÖ BAB 5 Kesimpulan</option>
                        <option value="Lampiran">üìé Lampiran</option>
                        <option value="Logbook">üìì Logbook</option>
                        <option value="Lainnya">üîß Lainnya</option>
                    </select>
                </div>
                
                <!-- Ketercapaian -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        <i class="fas fa-bullseye mr-1 text-emerald-600"></i> Ketercapaian Pekan Ini *
                    </label>
                    <textarea id="ketercapaian" rows="3" placeholder="Apa yang sudah berhasil diselesaikan pekan ini?" 
                        class="w-full" required></textarea>
                </div>
                
                <!-- Kendala -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        <i class="fas fa-exclamation-triangle mr-1 text-amber-600"></i> Kendala yang Dihadapi *
                    </label>
                    <textarea id="kendala" rows="2" placeholder="Hambatan atau masalah yang ditemui selama pengerjaan" 
                        class="w-full" required></textarea>
                </div>
                
                <!-- Solusi -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        <i class="fas fa-lightbulb mr-1 text-violet-600"></i> Solusi yang Diusulkan *
                    </label>
                    <textarea id="solusi" rows="2" placeholder="Rencana tindak lanjut atau solusi untuk kendala di atas" 
                        class="w-full" required></textarea>
                </div>
                
                <!-- Status Message -->
                <div id="formStatus" class="text-center text-sm min-h-6 py-2"></div>
                
                <!-- Action Buttons -->
                <div class="flex space-x-3 pt-2">
                    <button type="button" onclick="closeModal()" 
                        class="flex-1 py-3.5 btn-secondary rounded-xl font-medium">
                        <i class="fas fa-times mr-2"></i> Batal
                    </button>
                    <button type="submit" 
                        class="flex-1 py-3.5 btn-primary rounded-xl font-medium">
                        <i class="fas fa-save mr-2"></i> Simpan Progress
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Modal Pesan Masuk -->
    <div id="messageModal" class="modal-overlay">
        <div class="modal-content notification-modal">
            <div class="flex justify-between items-center mb-6 pb-4 border-b border-gray-200">
                <div>
                    <h2 class="text-xl font-bold text-gray-900">‚úâÔ∏è Pesan Masuk</h2>
                    <p class="text-gray-600 text-sm mt-1">Pesan untuk kelompok Anda</p>
                </div>
                <button onclick="closeMessageModal()" class="w-10 h-10 rounded-full bg-gray-100 hover:bg-gray-200 flex items-center justify-center transition">
                    <i class="fas fa-times text-gray-600"></i>
                </button>
            </div>
            
            <!-- Daftar Pesan -->
            <div id="messagesList" class="space-y-4 max-h-96 overflow-y-auto scrollbar-thin pr-2">
                <div class="flex flex-col items-center justify-center py-10">
                    <i class="fas fa-spinner fa-spin text-3xl text-blue-500 mb-3"></i>
                    <p class="text-gray-600">Memuat pesan...</p>
                </div>
            </div>
            
            <!-- Status Pesan -->
            <div id="messageStatus" class="text-center text-sm mt-4 min-h-6"></div>
            
            <!-- Empty State Pesan -->
            <div id="emptyMessages" class="hidden text-center py-10">
                <div class="inline-flex items-center justify-center w-20 h-20 rounded-full bg-gray-100 mb-5">
                    <i class="fas fa-envelope-open-text text-3xl text-gray-400"></i>
                </div>
                <h3 class="text-lg font-semibold text-gray-900 mb-2">Belum Ada Pesan</h3>
                <p class="text-gray-600 max-w-md mx-auto">Belum ada pesan untuk kelompok Anda. Pesan akan muncul di sini jika dosen atau koordinator mengirimkan pesan untuk kelompok Anda.</p>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex space-x-3 pt-6 mt-6 border-t border-gray-200">
                <button onclick="closeMessageModal()" 
                        class="flex-1 py-3 btn-secondary rounded-xl font-medium">
                    <i class="fas fa-times mr-2"></i> Tutup
                </button>
                <button onclick="refreshMessages()" 
                        class="flex-1 py-3 btn-primary rounded-xl font-medium">
                    <i class="fas fa-sync-alt mr-2"></i> Refresh Pesan
                </button>
            </div>
        </div>
    </div>

    <script>
        // Konfigurasi API
        const LOGIN_API = "https://script.google.com/macros/s/AKfycbzQbSGEpEX7sXNzPkGc862tm9fqTTcCNoXgNvwsCNLkjEtz3BCXKV0yrH-U1teRmf8x/exec";
        const SUBMIT_API = "https://script.google.com/macros/s/AKfycbwcpWSTNXmnlGBtGJGQ_cdE7py3XcjnBlobMCpxLD-ngmoGO0VZD2IJ9w--MjTWKsKhqA/exec";
        const SPREADSHEET_ID = "108-o2wcOAHNrm1BlBl8YTj1H2YhQxs3WLLcEhJYb1hY";
        const MESSAGE_SPREADSHEET_ID = "11Y5ogELKeWNTGLNkicwlA1vywvxGryHUSB0VszktNPc";
        
        // Variabel global
        let loggedInData = null;
        let allProgressData = []; // Menyimpan semua data progress
        let filteredProgressData = []; // Data yang difilter
        let groupMessages = []; // Menyimpan pesan untuk kelompok
        const semuaBagian = [
            "Judul Penelitian", 
            "BAB 1 Pendahuluan", 
            "BAB 2 Tinjauan Pustaka", 
            "BAB 3 Metode Penelitian", 
            "BAB 4 Hasil dan Pembahasan", 
            "BAB 5 Kesimpulan", 
            "Lampiran", 
            "Logbook"
        ];
        
        // Daftar nama hari dalam Bahasa Indonesia
        const hariIndo = ["Minggu", "Senin", "Selasa", "Rabu", "Kamis", "Jumat", "Sabtu"];
        const bulanIndo = ["Januari", "Februari", "Maret", "April", "Mei", "Juni", "Juli", "Agustus", "September", "Oktober", "November", "Desember"];
        
        // Format timestamp: DD/MM/YYYY HH:MM:SS
        function formatTimestamp(timestamp) {
            if (!timestamp) return "-";
            
            try {
                const date = new Date(timestamp);
                const day = date.getDate().toString().padStart(2, '0');
                const month = (date.getMonth() + 1).toString().padStart(2, '0');
                const year = date.getFullYear();
                const hours = date.getHours().toString().padStart(2, '0');
                const minutes = date.getMinutes().toString().padStart(2, '0');
                const seconds = date.getSeconds().toString().padStart(2, '0');
                
                return `${day}/${month}/${year} ${hours}:${minutes}:${seconds}`;
            } catch (e) {
                // Jika parsing gagal, coba format lain
                if (typeof timestamp === 'string') {
                    // Coba ekstrak tanggal dari string
                    const dateMatch = timestamp.match(/\d{4}[-/]\d{2}[-/]\d{2}/);
                    if (dateMatch) {
                        const parts = dateMatch[0].split(/[-/]/);
                        if (parts.length === 3) {
                            return `${parts[2]}/${parts[1]}/${parts[0]} ${timestamp.includes(':') ? timestamp.split(' ')[1] || '00:00:00' : '00:00:00'}`;
                        }
                    }
                }
                return timestamp.toString();
            }
        }
        
        // Format tanggal: EEEE, dd/MM/yyyy
        function formatTanggal(dateValue, includeTime = false) {
            if (!dateValue) return "-";
            
            try {
                const date = new Date(dateValue);
                const hari = hariIndo[date.getDay()];
                const tanggal = date.getDate().toString().padStart(2, '0');
                const bulan = (date.getMonth() + 1).toString().padStart(2, '0');
                const tahun = date.getFullYear();
                
                let result = `${hari}, ${tanggal}/${bulan}/${tahun}`;
                
                if (includeTime) {
                    const jam = date.getHours().toString().padStart(2, '0');
                    const menit = date.getMinutes().toString().padStart(2, '0');
                    result += ` ${jam}:${menit}`;
                }
                
                return result;
            } catch (e) {
                // Jika parsing gagal, coba format lain
                if (typeof dateValue === 'string') {
                    // Coba ekstrak tanggal dari string
                    const dateMatch = dateValue.match(/\d{4}-\d{2}-\d{2}/);
                    if (dateMatch) {
                        return formatTanggal(dateMatch[0], includeTime);
                    }
                }
                return dateValue.toString();
            }
        }
        
        // Fungsi untuk mendapatkan tanggal sekarang dalam format yang diinginkan
        function getCurrentDateFormatted() {
            const now = new Date();
            return formatTanggal(now, true);
        }
        
        // Fungsi untuk format tanggal menjadi string untuk Google Sheets
        function formatDateForGoogleSheets(date) {
            const year = date.getFullYear();
            const month = (date.getMonth() + 1).toString().padStart(2, '0');
            const day = date.getDate().toString().padStart(2, '0');
            const hours = date.getHours().toString().padStart(2, '0');
            const minutes = date.getMinutes().toString().padStart(2, '0');
            const seconds = date.getSeconds().toString().padStart(2, '0');
            
            return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;
        }
        
        // Fungsi login
        async function login() {
            const user = document.getElementById("user").value.trim();
            const pass = document.getElementById("pass").value.trim();
            const info = document.getElementById("info");
            
            // Reset info
            info.innerHTML = "";
            info.className = "text-center text-sm min-h-6";
            
            // Validasi input
            if (!user || !pass) {
                info.innerHTML = '<div class="inline-flex items-center px-4 py-2.5 bg-amber-50 text-amber-700 rounded-lg border border-amber-200"><i class="fas fa-exclamation-triangle mr-2"></i> Harap isi nama ketua dan anggota</div>';
                return;
            }
            
            // Tampilkan loading
            info.innerHTML = '<div class="inline-flex items-center px-4 py-2.5 bg-blue-50 text-blue-700 rounded-lg border border-blue-200"><i class="fas fa-spinner fa-spin mr-2"></i> Memverifikasi data login...</div>';
            
            try {
                // Kirim permintaan ke API
                const response = await fetch(`${LOGIN_API}?user=${encodeURIComponent(user)}&pass=${encodeURIComponent(pass)}`);
                const data = await response.json();
                
                if (data.status === "sukses") {
                    // Simpan data login
                    loggedInData = {
                        ketua: data.ketua,
                        anggota: data.anggota,
                        kategori: data.kategori,
                        judul: data.judul,
                        user: user,
                        pass: pass
                    };
                    
                    // Tampilkan pesan sukses
                    info.innerHTML = '<div class="inline-flex items-center px-4 py-2.5 bg-emerald-50 text-emerald-700 rounded-lg border border-emerald-200"><i class="fas fa-check-circle mr-2"></i> Login berhasil! Mengalihkan...</div>';
                    
                    // Format judul penelitian agar lebih rapi
                    const formattedJudul = formatJudul(data.judul);
                    
                    // Tampilkan data kelompok
                    document.getElementById("ketua").textContent = data.ketua;
                    document.getElementById("anggota").textContent = data.anggota;
                    document.getElementById("kategori").textContent = data.kategori;
                    document.getElementById("judul").innerHTML = formattedJudul;
                    
                    // Update modal data
                    document.getElementById("modalKetua").textContent = data.ketua;
                    document.getElementById("modalAnggota").textContent = data.anggota;
                    document.getElementById("modalKategori").textContent = data.kategori;
                    document.getElementById("modalJudul").innerHTML = formattedJudul;
                    
                    // Update tanggal saat ini di modal
                    document.getElementById("currentDateDisplay").textContent = getCurrentDateFormatted();
                    
                    // Ganti tampilan ke dashboard
                    setTimeout(() => {
                        document.getElementById("loginContainer").classList.add("hidden");
                        document.getElementById("dashboardContainer").classList.remove("hidden");
                        document.getElementById("dashboardContainer").classList.add("fade-in");
                        document.getElementById("floatingBtn").classList.remove("hidden");
                        
                        // Muat data progress
                        loadProgressData();
                        
                        // Muat pesan untuk kelompok
                        loadMessages();
                    }, 800);
                    
                } else {
                    info.innerHTML = '<div class="inline-flex items-center px-4 py-2.5 bg-rose-50 text-rose-700 rounded-lg border border-rose-200"><i class="fas fa-times-circle mr-2"></i> Login gagal. Periksa kembali nama ketua dan anggota.</div>';
                }
            } catch (error) {
                console.error("Error:", error);
                info.innerHTML = '<div class="inline-flex items-center px-4 py-2.5 bg-rose-50 text-rose-700 rounded-lg border border-rose-200"><i class="fas fa-exclamation-circle mr-2"></i> Terjadi kesalahan jaringan. Coba lagi.</div>';
            }
        }
        
        // Fungsi untuk memuat pesan dari spreadsheet
        async function loadMessages() {
            try {
                // URL untuk mengambil data pesan dari spreadsheet
                const messageUrl = `https://docs.google.com/spreadsheets/d/${MESSAGE_SPREADSHEET_ID}/gviz/tq?tqx=out:json`;
                
                // Mengambil data dari spreadsheet
                const response = await fetch(messageUrl);
                const text = await response.text();
                
                // Parse data JSON dari Google Sheets
                const jsonText = text.substring(text.indexOf('{'), text.lastIndexOf('}') + 1);
                const data = JSON.parse(jsonText);
                
                // Proses data pesan
                processMessageData(data);
                
            } catch (error) {
                console.error("Error loading messages:", error);
                showMessageError();
            }
        }
        
        // Fungsi untuk memproses data pesan
        function processMessageData(data) {
            // Mendapatkan header kolom
            const columns = data.table.cols.map(col => col.label || "");
            
            // Mendapatkan baris data
            const rows = data.table.rows;
            
            // Cari indeks kolom yang dibutuhkan
            const timestampIndex = columns.findIndex(col => col.toLowerCase().includes("timestamp") || col === "Timestamp");
            const ketuaIndex = columns.findIndex(col => col.toLowerCase().includes("nama ketua") || col.toLowerCase().includes("ketua") || col === "Nama Ketua");
            const anggotaIndex = columns.findIndex(col => col.toLowerCase().includes("nama anggota") || col.toLowerCase().includes("anggota") || col === "Nama Anggota");
            const pesanIndex = columns.findIndex(col => col.toLowerCase().includes("pesan") || col === "Pesan untuk kelompok");
            
            // Reset data
            groupMessages = [];
            
            // Proses semua baris data
            rows.forEach(row => {
                const cellValues = row.c.map(cell => cell ? (cell.v || "") : "");
                
                // Ambil data pesan
                const timestamp = timestampIndex >= 0 ? cellValues[timestampIndex] : new Date();
                const ketua = ketuaIndex >= 0 ? (cellValues[ketuaIndex] || "").toString() : "";
                const anggota = anggotaIndex >= 0 ? (cellValues[anggotaIndex] || "").toString() : "";
                const pesan = pesanIndex >= 0 ? (cellValues[pesanIndex] || "") : "";
                
                // Cocokkan dengan data login (gunakan nama depan)
                const loggedKetua = loggedInData ? loggedInData.user.toLowerCase() : "";
                const loggedAnggota = loggedInData ? loggedInData.pass.toLowerCase() : "";
                
                // Jika data cocok, tambahkan ke groupMessages
                if (loggedKetua && loggedAnggota) {
                    const ketuaLower = ketua.toLowerCase();
                    const anggotaLower = anggota.toLowerCase();
                    
                    if ((ketuaLower.includes(loggedKetua) && anggotaLower.includes(loggedAnggota)) ||
                        (ketua === "" && anggota === "")) { // Pesan untuk semua kelompok
                        
                        const messageItem = {
                            timestamp: timestamp,
                            formattedTimestamp: formatTimestamp(timestamp),
                            ketua: ketua,
                            anggota: anggota,
                            pesan: pesan,
                            dateObj: new Date(timestamp),
                            isRead: false // Default belum dibaca
                        };
                        
                        groupMessages.push(messageItem);
                    }
                }
            });
            
            // Urutkan data dari yang terbaru (berdasarkan timestamp)
            groupMessages.sort((a, b) => b.dateObj - a.dateObj);
            
            // Update notifikasi
            updateNotification();
            
            // Update tampilan pesan di modal jika modal terbuka
            if (document.getElementById("messageModal").style.display === "flex") {
                displayMessages();
            }
        }
        
        // Fungsi untuk update notifikasi
        function updateNotification() {
            const notificationButton = document.getElementById("notificationButton");
            const notificationBadge = document.getElementById("notificationBadge");
            
            if (groupMessages.length > 0) {
                // Hitung pesan yang belum dibaca
                const unreadCount = groupMessages.filter(msg => !msg.isRead).length;
                
                // Tampilkan tombol notifikasi
                notificationButton.classList.remove("hidden");
                
                // Update badge
                if (unreadCount > 0) {
                    notificationBadge.classList.remove("hidden");
                    notificationBadge.textContent = unreadCount;
                    
                    // Tambahkan efek bersinar jika ada pesan baru
                    if (unreadCount > 0) {
                        notificationButton.classList.add("notification-shine");
                    }
                } else {
                    notificationBadge.classList.add("hidden");
                    notificationButton.classList.remove("notification-shine");
                }
            } else {
                // Sembunyikan tombol notifikasi jika tidak ada pesan
                notificationButton.classList.add("hidden");
                notificationBadge.classList.add("hidden");
            }
        }
        
        // Fungsi untuk menampilkan pesan di modal
        function displayMessages() {
            const messagesList = document.getElementById("messagesList");
            const emptyMessages = document.getElementById("emptyMessages");
            const messageStatus = document.getElementById("messageStatus");
            
            if (groupMessages.length === 0) {
                messagesList.classList.add("hidden");
                emptyMessages.classList.remove("hidden");
                messageStatus.innerHTML = "";
                return;
            }
            
            messagesList.classList.remove("hidden");
            emptyMessages.classList.add("hidden");
            messagesList.innerHTML = "";
            
            groupMessages.forEach((message, index) => {
                const messageClass = message.isRead ? "message-item" : "message-item message-unread";
                
                const messageElement = document.createElement("div");
                messageElement.className = messageClass;
                messageElement.onclick = () => markMessageAsRead(index);
                
                messageElement.innerHTML = `
                    <div class="flex justify-between items-start mb-2">
                        <div>
                            <span class="text-xs font-semibold px-2 py-1 rounded bg-blue-100 text-blue-800">
                                ${message.ketua && message.anggota ? `Untuk: ${message.ketua} & ${message.anggota}` : "Pesan Umum"}
                            </span>
                        </div>
                        <div class="text-xs text-gray-500">${message.formattedTimestamp}</div>
                    </div>
                    <div class="text-gray-700">
                        ${message.pesan}
                    </div>
                    ${!message.isRead ? '<div class="text-xs text-amber-600 font-medium mt-2"><i class="fas fa-circle mr-1 text-xs"></i> Baru</div>' : ''}
                `;
                
                messagesList.appendChild(messageElement);
            });
            
            // Update status
            const unreadCount = groupMessages.filter(msg => !msg.isRead).length;
            if (unreadCount > 0) {
                messageStatus.innerHTML = `<div class="inline-flex items-center px-3 py-1.5 bg-amber-50 text-amber-700 rounded-lg border border-amber-200">
                    <i class="fas fa-envelope mr-2"></i> ${unreadCount} pesan belum dibaca
                </div>`;
            } else {
                messageStatus.innerHTML = `<div class="inline-flex items-center px-3 py-1.5 bg-emerald-50 text-emerald-700 rounded-lg border border-emerald-200">
                    <i class="fas fa-check-circle mr-2"></i> Semua pesan telah dibaca
                </div>`;
            }
        }
        
        // Fungsi untuk menandai pesan sebagai sudah dibaca
        function markMessageAsRead(index) {
            if (index >= 0 && index < groupMessages.length) {
                groupMessages[index].isRead = true;
                
                // Update tampilan
                displayMessages();
                
                // Update notifikasi
                updateNotification();
            }
        }
        
        // Fungsi untuk membuka modal pesan
        function openMessageModal() {
            document.getElementById("messageModal").style.display = "flex";
            displayMessages();
        }
        
        // Fungsi untuk menutup modal pesan
        function closeMessageModal() {
            document.getElementById("messageModal").style.display = "none";
        }
        
        // Fungsi untuk refresh pesan
        async function refreshMessages() {
            const refreshBtn = event.target.closest('button');
            const originalHtml = refreshBtn.innerHTML;
            refreshBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Loading...';
            refreshBtn.disabled = true;
            
            await loadMessages();
            
            setTimeout(() => {
                refreshBtn.innerHTML = originalHtml;
                refreshBtn.disabled = false;
            }, 1000);
        }
        
        // Fungsi untuk menampilkan error pesan
        function showMessageError() {
            const messagesList = document.getElementById("messagesList");
            messagesList.innerHTML = `
                <div class="text-center py-10">
                    <div class="inline-flex items-center px-4 py-3 bg-rose-50 text-rose-700 rounded-lg border border-rose-200">
                        <i class="fas fa-exclamation-triangle mr-3"></i>
                        <div class="text-left">
                            <p class="font-medium">Gagal memuat pesan</p>
                            <p class="text-sm mt-1">Coba refresh atau periksa koneksi internet</p>
                        </div>
                    </div>
                </div>
            `;
        }
        
        // Fungsi untuk memformat judul penelitian agar lebih rapi
        function formatJudul(judul) {
            if (!judul) return "-";
            
            // Jika judul pendek, langsung tampilkan
            if (judul.length <= 50) return judul;
            
            // Jika judul panjang, pecah dengan <br> pada spasi tertentu
            const words = judul.split(' ');
            let result = '';
            let line = '';
            
            for (let i = 0; i < words.length; i++) {
                if (line.length + words[i].length + 1 > 40) {
                    result += line + '<br>';
                    line = words[i] + ' ';
                } else {
                    line += words[i] + ' ';
                }
            }
            
            result += line;
            return result;
        }
        
        // Fungsi untuk memuat data progress dari spreadsheet
        async function loadProgressData() {
            try {
                // Tampilkan loading
                document.getElementById("emptyProgress").classList.add("hidden");
                
                // URL untuk mengambil data dari spreadsheet
                const progressUrl = `https://docs.google.com/spreadsheets/d/${SPREADSHEET_ID}/gviz/tq?tqx=out:json`;
                
                // Mengambil data dari spreadsheet
                const response = await fetch(progressUrl);
                const text = await response.text();
                
                // Parse data JSON dari Google Sheets
                const jsonText = text.substring(text.indexOf('{'), text.lastIndexOf('}') + 1);
                const data = JSON.parse(jsonText);
                
                // Proses data
                processProgressData(data);
                
            } catch (error) {
                console.error("Error loading progress data:", error);
                showErrorProgress();
            }
        }
        
        // Fungsi refresh data
        async function refreshProgressData() {
            const refreshBtn = event.target.closest('button');
            const originalHtml = refreshBtn.innerHTML;
            refreshBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Loading...';
            refreshBtn.disabled = true;
            
            await loadProgressData();
            
            setTimeout(() => {
                refreshBtn.innerHTML = originalHtml;
                refreshBtn.disabled = false;
            }, 1000);
        }
        
        // Fungsi untuk memproses data progress
        function processProgressData(data) {
            // Mendapatkan header kolom
            const columns = data.table.cols.map(col => col.label || "");
            
            // Mendapatkan baris data
            const rows = data.table.rows;
            
            // Cari indeks kolom yang dibutuhkan
            const ketuaIndex = columns.findIndex(col => col.toLowerCase().includes("nama ketua") || col.toLowerCase().includes("ketua") || col === "Nama Ketua");
            const anggotaIndex = columns.findIndex(col => col.toLowerCase().includes("nama anggota") || col.toLowerCase().includes("anggota") || col === "Nama Anggota");
            const timestampIndex = columns.findIndex(col => col.toLowerCase().includes("timestamp") || col.toLowerCase().includes("waktu") || col === "Timestamp");
            const bagianIndex = columns.findIndex(col => col.toLowerCase().includes("bagian") || col.toLowerCase().includes("dikerjakan") || col === "Bagian yang Sudah Dikerjakan");
            const ketercapaianIndex = columns.findIndex(col => col.toLowerCase().includes("ketercapaian") || col.toLowerCase().includes("pekan") || col === "Ketercapaian Pekan Ini");
            const kendalaIndex = columns.findIndex(col => col.toLowerCase().includes("kendala") || col.toLowerCase().includes("masalah") || col === "Kendala yang Dihadapi");
            const solusiIndex = columns.findIndex(col => col.toLowerCase().includes("solusi") || col.toLowerCase().includes("link") || col === "Solusi");
            
            // Reset data
            allProgressData = [];
            const bagianDikerjakan = new Set(); // Untuk melacak bagian unik yang sudah dikerjakan
            
            // Proses semua baris data
            rows.forEach(row => {
                const cellValues = row.c.map(cell => cell ? (cell.v || "") : "");
                
                // Cek apakah baris ini milik kelompok yang login
                const ketuaCell = ketuaIndex >= 0 ? (cellValues[ketuaIndex] || "").toString().toLowerCase() : "";
                const anggotaCell = anggotaIndex >= 0 ? (cellValues[anggotaIndex] || "").toString().toLowerCase() : "";
                
                // Cocokkan dengan data login (gunakan nama depan)
                const loggedKetua = loggedInData.user.toLowerCase();
                const loggedAnggota = loggedInData.pass.toLowerCase();
                
                // Jika data cocok, tambahkan ke allProgressData
                if (ketuaCell.includes(loggedKetua) && anggotaCell.includes(loggedAnggota)) {
                    const timestamp = timestampIndex >= 0 ? cellValues[timestampIndex] : new Date();
                    const progressItem = {
                        timestamp: timestamp,
                        bagian: bagianIndex >= 0 ? (cellValues[bagianIndex] || "") : "",
                        ketercapaian: ketercapaianIndex >= 0 ? (cellValues[ketercapaianIndex] || "") : "",
                        kendala: kendalaIndex >= 0 ? (cellValues[kendalaIndex] || "") : "",
                        solusi: solusiIndex >= 0 ? (cellValues[solusiIndex] || "") : "",
                        dateObj: new Date(timestamp)
                    };
                    
                    allProgressData.push(progressItem);
                    
                    // Kumpulkan bagian yang sudah dikerjakan
                    if (progressItem.bagian && !bagianDikerjakan.has(progressItem.bagian)) {
                        bagianDikerjakan.add(progressItem.bagian);
                    }
                }
            });
            
            // Urutkan data dari yang terbaru (berdasarkan timestamp)
            allProgressData.sort((a, b) => b.dateObj - a.dateObj);
            
            // Filter data default (semua data)
            filterProgress('all');
            
            // Hitung progress berdasarkan bagian yang sudah dikerjakan
            const jumlahBagianDikerjakan = bagianDikerjakan.size;
            const totalBagian = semuaBagian.length;
            const progressPercent = Math.round((jumlahBagianDikerjakan / totalBagian) * 100);
            
            // Update progress bar dan teks
            document.getElementById("progressPercent").textContent = `${progressPercent}%`;
            document.getElementById("progressText").textContent = `(${jumlahBagianDikerjakan}/${totalBagian} bagian)`;
            document.getElementById("progressFill").style.width = `${progressPercent}%`;
            
            // Update bagian yang sudah dikerjakan
            updateCompletedSections(bagianDikerjakan);
            
            // Update last update time
            const now = new Date();
            document.getElementById("lastUpdate").textContent = `Data terakhir: ${formatTanggal(now, true)}`;
        }
        
        // Fungsi untuk filter data progress
        function filterProgress(filterType) {
            // Update tombol filter aktif
            document.getElementById('filterAll').className = filterType === 'all' ? 'filter-btn active' : 'filter-btn inactive';
            document.getElementById('filterMonth').className = filterType === 'month' ? 'filter-btn active' : 'filter-btn inactive';
            document.getElementById('filterWeek').className = filterType === 'week' ? 'filter-btn active' : 'filter-btn inactive';
            
            // Filter data berdasarkan jenis filter
            const now = new Date();
            let cutoffDate = new Date();
            
            if (filterType === 'month') {
                // 30 hari terakhir
                cutoffDate.setDate(now.getDate() - 30);
            } else if (filterType === 'week') {
                // 7 hari terakhir
                cutoffDate.setDate(now.getDate() - 7);
            } else {
                // Semua data (tidak ada filter tanggal)
                cutoffDate = null;
            }
            
            if (cutoffDate) {
                filteredProgressData = allProgressData.filter(item => {
                    return item.dateObj >= cutoffDate;
                });
            } else {
                filteredProgressData = [...allProgressData];
            }
            
            // Tampilkan data yang sudah difilter
            displayProgressTable();
        }
        
        // Fungsi untuk menampilkan data progress di tabel
        function displayProgressTable() {
            const table = document.getElementById("progressTable");
            
            if (filteredProgressData.length === 0) {
                table.innerHTML = `
                    <tr>
                        <td colspan="5" class="px-6 py-10 text-center">
                            <div class="inline-flex items-center px-4 py-3 bg-amber-50 text-amber-700 rounded-lg border border-amber-200">
                                <i class="fas fa-info-circle mr-3"></i>
                                <div class="text-left">
                                    <p class="font-medium">Tidak ada data untuk filter ini</p>
                                    <p class="text-sm mt-1">Coba pilih filter lain atau tambah data baru</p>
                                </div>
                            </div>
                        </td>
                    </tr>
                `;
                return;
            }
            
            table.innerHTML = "";
            
            filteredProgressData.forEach((item, index) => {
                const tr = document.createElement("tr");
                tr.className = "table-row";
                
                // Timestamp dengan format: EEEE, dd/MM/yyyy
                const timestamp = formatTanggal(item.timestamp, true);
                tr.innerHTML += `<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 font-medium">
                    <div class="font-semibold">${timestamp.split(' ')[0]}</div>
                    <div class="text-xs text-gray-500">${timestamp.split(' ')[1]}</div>
                </td>`;
                
                // Bagian dikerjakan
                const bagian = item.bagian || "-";
                tr.innerHTML += `<td class="px-6 py-4 whitespace-nowrap">
                    <span class="px-3 py-1.5 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800">
                        ${bagian}
                    </span>
                </td>`;
                
                // Ketercapaian pekan ini
                const ketercapaian = item.ketercapaian || "-";
                const ketercapaianShort = ketercapaian.length > 60 ? ketercapaian.substring(0, 60) + "..." : ketercapaian;
                tr.innerHTML += `<td class="px-6 py-4 text-sm text-gray-700" title="${ketercapaian}">${ketercapaianShort}</td>`;
                
                // Kendala
                const kendala = item.kendala || "-";
                const kendalaShort = kendala.length > 60 ? kendala.substring(0, 60) + "..." : kendala;
                tr.innerHTML += `<td class="px-6 py-4 text-sm text-gray-700" title="${kendala}">${kendalaShort}</td>`;
                
                // Solusi
                const solusi = item.solusi || "-";
                let solusiHtml = solusi;
                
                // Jika solusi berisi URL, buat sebagai link
                if (typeof solusi === "string" && (solusi.startsWith("http://") || solusi.startsWith("https://"))) {
                    const displayText = solusi.length > 40 ? solusi.substring(0, 40) + "..." : solusi;
                    solusiHtml = `<a href="${solusi}" target="_blank" class="text-blue-600 hover:text-blue-800 font-medium underline" title="${solusi}">${displayText}</a>`;
                } else if (solusi.length > 60) {
                    solusiHtml = `<span title="${solusi}">${solusi.substring(0, 60)}...</span>`;
                }
                
                tr.innerHTML += `<td class="px-6 py-4 text-sm text-gray-700">${solusiHtml}</td>`;
                
                table.appendChild(tr);
            });
        }
        
        // Fungsi untuk update bagian yang sudah dikerjakan
        function updateCompletedSections(bagianDikerjakan) {
            const sectionsList = document.getElementById("sectionsList");
            sectionsList.innerHTML = "";
            
            if (bagianDikerjakan.size === 0) {
                sectionsList.innerHTML = '<span class="text-sm text-gray-500 italic">Belum ada bagian yang dikerjakan</span>';
                return;
            }
            
            // Tampilkan semua bagian dengan status
            semuaBagian.forEach(bagian => {
                const isCompleted = bagianDikerjakan.has(bagian);
                const badgeClass = isCompleted 
                    ? "bg-emerald-100 text-emerald-800 border border-emerald-200" 
                    : "bg-gray-100 text-gray-500 border border-gray-200";
                
                sectionsList.innerHTML += `
                    <span class="badge ${badgeClass}">
                        ${isCompleted ? '<i class="fas fa-check mr-1.5 text-xs"></i>' : '<i class="far fa-circle mr-1.5 text-xs"></i>'}
                        ${bagian}
                    </span>
                `;
            });
        }
        
        // Fungsi untuk menampilkan error progress
        function showErrorProgress() {
            const table = document.getElementById("progressTable");
            table.innerHTML = `
                <tr>
                    <td colspan="5" class="px-6 py-10 text-center">
                        <div class="inline-flex items-center px-4 py-3 bg-rose-50 text-rose-700 rounded-lg border border-rose-200">
                            <i class="fas fa-exclamation-triangle mr-3"></i>
                            <div class="text-left">
                                <p class="font-medium">Gagal memuat data progress</p>
                                <p class="text-sm mt-1">Coba refresh halaman atau periksa koneksi internet</p>
                            </div>
                        </div>
                    </td>
                </tr>
            `;
        }
        
        // Fungsi untuk membuka modal input data
        function openModal() {
            // Update tanggal saat ini di modal
            document.getElementById("currentDateDisplay").textContent = getCurrentDateFormatted();
            
            document.getElementById("modalOverlay").style.display = "flex";
            // Reset form
            document.getElementById("formRiset").reset();
            document.getElementById("formStatus").innerHTML = "";
        }
        
        // Fungsi untuk menutup modal
        function closeModal() {
            document.getElementById("modalOverlay").style.display = "none";
        }
        
        // Fungsi untuk submit form progress
        document.getElementById("formRiset").addEventListener("submit", async function(e) {
            e.preventDefault();
            
            const formStatus = document.getElementById("formStatus");
            const submitBtn = this.querySelector('button[type="submit"]');
            const originalBtnText = submitBtn.innerHTML;
            
            // Tampilkan loading
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Menyimpan...';
            submitBtn.disabled = true;
            formStatus.innerHTML = "";
            
            // Siapkan data untuk dikirim
            const currentDate = new Date();
            const timestampForSheets = formatDateForGoogleSheets(currentDate);
            
            const data = {
                namaKetua: loggedInData.ketua,
                namaAnggota: loggedInData.anggota,
                kategori: loggedInData.kategori,
                judul: loggedInData.judul,
                bagian: document.getElementById("bagian").value,
                ketercapaian: document.getElementById("ketercapaian").value,
                kendala: document.getElementById("kendala").value,
                solusi: document.getElementById("solusi").value,
                timestamp: timestampForSheets // Format untuk Google Sheets
            };
            
            try {
                // Kirim data ke Google Apps Script
                const response = await fetch(SUBMIT_API, {
                    method: "POST",
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                
                if (result.status === "success") {
                    formStatus.innerHTML = '<div class="inline-flex items-center px-4 py-2.5 bg-emerald-50 text-emerald-700 rounded-lg border border-emerald-200"><i class="fas fa-check-circle mr-2"></i> Progress berhasil disimpan!</div>';
                    
                    // Reset form
                    document.getElementById("formRiset").reset();
                    
                    // Refresh data progress setelah 1.5 detik
                    setTimeout(() => {
                        closeModal();
                        loadProgressData();
                    }, 1500);
                    
                } else {
                    formStatus.innerHTML = '<div class="inline-flex items-center px-4 py-2.5 bg-rose-50 text-rose-700 rounded-lg border border-rose-200"><i class="fas fa-times-circle mr-2"></i> Gagal menyimpan data</div>';
                }
            } catch (error) {
                console.error("Error:", error);
                formStatus.innerHTML = '<div class="inline-flex items-center px-4 py-2.5 bg-rose-50 text-rose-700 rounded-lg border border-rose-200"><i class="fas fa-exclamation-circle mr-2"></i> Terjadi kesalahan jaringan</div>';
            } finally {
                // Restore button state
                submitBtn.innerHTML = originalBtnText;
                submitBtn.disabled = false;
            }
        });
        
        // Fungsi logout
        function logout() {
            // Reset form
            document.getElementById("user").value = "";
            document.getElementById("pass").value = "";
            document.getElementById("info").innerHTML = "";
            
            // Reset data
            loggedInData = null;
            allProgressData = [];
            filteredProgressData = [];
            groupMessages = [];
            
            // Kembali ke halaman login
            document.getElementById("dashboardContainer").classList.add("hidden");
            document.getElementById("floatingBtn").classList.add("hidden");
            document.getElementById("notificationButton").classList.add("hidden");
            document.getElementById("loginContainer").classList.remove("hidden");
            document.getElementById("loginContainer").classList.add("fade-in");
        }
        
        // Event listener untuk enter key dan floating button
        document.addEventListener("DOMContentLoaded", function() {
            // Enter key untuk login
            document.getElementById("user").addEventListener("keypress", function(e) {
                if (e.key === "Enter") login();
            });
            
            document.getElementById("pass").addEventListener("keypress", function(e) {
                if (e.key === "Enter") login();
            });
            
            // Floating button click
            document.getElementById("floatingBtn").addEventListener("click", openModal);
            
            // Close modal ketika klik di luar modal
            document.getElementById("modalOverlay").addEventListener("click", function(e) {
                if (e.target === this) closeModal();
            });
            
            // Close modal pesan ketika klik di luar modal
            document.getElementById("messageModal").addEventListener("click", function(e) {
                if (e.target === this) closeMessageModal();
            });
        });
    </script>
</body>
</html>
